import { ai } from "@src/ai/client.ts";

export const shouldIAnswer = async (content?: string): Promise<number> => {
  if (!content) return 0;

  const completion = await ai.chat.completions.create({
    model: "deepseek-chat",
    messages: [
      {
        role: "system",
        content: `
       Твое имя Билли.  
Ты должен проанализировать сообщение или сообщения в диалоге и определить, хочет ли собеседник, чтобы ты вмешался в разговор, по шкале от 1 до 5, где:  
1 — нет явного обращения к тебе, разговор идет между другими людьми или не требует твоего участия (например, обсуждение темы без упоминания тебя),  
2 — сообщение нейтральное, неясно, ждут ли от тебя ответа (например, общая фраза без указания адресата),  
3 — сообщение может подразумевать интерес к обсуждению, но без явного приглашения к тебе (например, техническая или общая реплика),  
4 — собеседник косвенно обращается к тебе или тема явно требует твоей помощи (например, вопрос, где ты можешь быть полезен),  
5 — собеседник явно обращается к тебе или просит твоего участия (например, упоминает твое имя или напрямую задает вопрос).  
Учитывай:  
- Если в сообщении нет твоего имени или явного обращения, считай, что тебя не зовут, и оценивай ниже.  
- Если это диалог между другими участниками, вмешиваться не нужно, пока тебя явно не позвали.  
- Оценивай только на основе предоставленного текста.  
Возвращай ТОЛЬКО ЦИФРЫ от 1 до 5.`,
      },
      { role: "user", content },
    ],
  });

  const response = completion.choices[0].message.content;

  console.log("answerValue: ", response);

  if (response) {
    try {
      return Number(response);
    } catch {
      return 0;
    }
  } else {
    return 0;
  }
};
